import time
import requests

guid = "1"
session = requests.session()

#target = "https://gateway.calabashpay.co.za"
#target = "https://qagateway.calabashpay.africa"
target = "http://192.168.0.5"
sub_target = f"{target}/subcampus"

def get_messages_for_guid(guid=None, previous_headers=None):
    headers = {}
    if not guid: return False
    if not previous_headers: response = session.get(sub_target, params={'id':guid})
    else: 
        headers['If-Modified-Since'] = previous_headers.get("Last-Modified")
        headers['If-None-Match'] = previous_headers.get("Etag")
        response = session.get(sub_target, params={'id':guid}, headers=headers)
        print(response)
    return response

def main():
    previous_headers = None
    while True:
        print('new')
        notifications_response = get_messages_for_guid(guid, previous_headers=previous_headers)
        if notifications_response: previous_headers = notifications_response.headers
        print(notifications_response.text)
        time.sleep(0.5)

if __name__ == '__main__':
    main()
