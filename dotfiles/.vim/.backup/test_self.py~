#!/usr/bin/python3
import hashlib
import os
import requests
import base64

base_url = "http://tripstar.dotxmltech.com"

curdir = os.path.abspath(os.path.curdir)
datadir = os.path.join(curdir, 'datadir')
if not os.path.exists(datadir): os.mkdir(datadir)

def get_checksum(filecontent=None):
    if not filecontent: return False
    sha256sum = hashlib.sha256()
    sha256sum.update(filecontent)
    return sha256sum.hexdigest()

def test_upload_image():
    headers = {}
    headers['apikey'] = "TotallySecureProductionAPIKEYPHRASE4InfiniteSecurityAndSuchThingsAlso"
    target_url = f"{base_url}/upload_image?"
    filename = 'something3.png'
    target_file = os.path.abspath(filename)
    print(target_file)
    with open(target_file, 'rb') as f: contents = f.read()
    checksum = get_checksum(contents)
    package = {}
    file_contents = base64.b64encode(contents)
    package['contents'] = str(file_contents, encoding='utf8')
    package['filename'] = filename 
    package['sha256sum'] = checksum
    package['These Extra Kwargs'] = 'Will exist as key value pairs'
    package['driver_name'] = 'Pieter Botha'
    r = requests.post(target_url, headers=headers, json=package)
    print(r.status_code)
    print(r.json())
    return True

if __name__ == '__main__':
    t = test_upload_image()
