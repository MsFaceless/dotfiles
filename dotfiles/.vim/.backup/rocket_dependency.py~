#!/bin/python

from pydot import Dot, Edge, Node

class DependencyGraph(Dot):

    def __init__(self, *args, **kwargs):
        super().__init__()
        self.color = kwargs.get('color', 'lightgray')
        self.style = kwargs.get('style', 'filled')
        self.fontname = kwargs.get('fontname', 'Arial')
        self.fontsize = kwargs.get('fontsize', '10')
        self.set_node_defaults(color=self.color, style=self.style, fontname=self.fontname, fontsize=self.fontsize)

    def add_circle(self, name):
        circle = Node(name)
        self.add_node(circle)
        return circle

    def add_line(self, line_from, line_to):
        line = Edge(line_from, line_to)
        self.add_edge(line)
        return line

    def draw(self, filepath='test.png'):
        self.write_png(filepath)
        return filepath

if __name__ == "__main__":

    g = DependencyGraph()

    time = g.add_circle('Time')
    duration = g.add_circle('Duration')
    role = g.add_circle('Role')

    dow = g.add_circle('Role Day Of Week')

    sd = g.add_line(role, dow)
    sd = g.add_line(duration, dow)
    sd = g.add_line(time, dow)

    sys = g.add_circle('System Owner')
    branch = g.add_circle('Branch')

    sd = g.add_line(sys, branch)

    bdow = g.add_circle('Branch Day Of Week')

    sd = g.add_line(branch, bdow)
    sd = g.add_line(duration, bdow)
    sd = g.add_line(time, bdow)

    brole = g.add_circle('Branch Role')

    sd = g.add_line(branch, brole)
    sd = g.add_line(role, brole)

    user = g.add_circle('User')

    sd = g.add_line(branch, user)
    sd = g.add_line(role, user)

    appt = g.add_circle('Appointment')

    sd = g.add_line(user, appt)



    """
    vault = g.add_circle('Vault')

    imali = g.add_circle('iMali')

    gateway = g.add_circle('Gateway')
    gv = g.add_line(vault, gateway)
    gv = g.add_line(imali, gateway)

    mobile = g.add_circle('Calabash Mobile')
    gm = g.add_line(gateway, mobile)

    merchant = g.add_circle('Merchant')
    gm = g.add_line(gateway, merchant)

    eiffelback = g.add_circle('Eiffel Back Office')
    gm = g.add_line(gateway, eiffelback)

    eiffelfront = g.add_circle('Eiffel Trading')
    gm = g.add_line(gateway, eiffelfront)
    gm = g.add_line(eiffelback, eiffelfront)

    campus = g.add_circle('Calabash Campus')
    gm = g.add_line(gateway, campus)
    gm = g.add_line(eiffelback, campus)
    """


    """
    deon = g.add_circle('Deon')
    jp = g.add_circle('JP')
    lucas = g.add_circle('Lucas')
    trevor = g.add_circle('Trevor')
    tjaart = g.add_circle('Tjaart')
    camilla = g.add_circle('Camilla')
    hannes = g.add_circle('Hannes')
    brenda = g.add_circle('Brenda')
    tafadzwa = g.add_circle('Tafadzwa')
    dean = g.add_circle('Dean')

    g.add_line(deon, jp)
    g.add_line(deon, lucas)
    #g.add_line(deon, trevor)
    #g.add_line(deon, brenda)
    g.add_line(deon, camilla)

    #g.add_line(jp, camilla)
    #g.add_line(lucas, camilla)

    g.add_line(camilla, brenda)
    g.add_line(camilla, trevor)
    g.add_line(camilla, tjaart)
    g.add_line(camilla, hannes)
    g.add_line(camilla, tafadzwa)
    g.add_line(camilla, dean)
    """

    """
    entity = g.add_circle('Entity')

    person = g.add_circle('Person')

    member = g.add_circle('Member')
    mp = g.add_line(person, member)

    organisation = g.add_circle('Organisation')
    em = g.add_line(entity, person)
    eo = g.add_line(entity, organisation)

    inter = g.add_circle('Intermediary')
    im = g.add_line(person, inter)
    io = g.add_line(organisation, inter)

    product = g.add_circle('Product')
    po = g.add_line(organisation, product)

    benefit = g.add_circle('Product Benefit')
    pb = g.add_line(product, benefit)

    asset = g.add_circle('Asset')

    vehicle = g.add_circle('Vehicle')
    va = g.add_line(asset, vehicle)

    aproperty = g.add_circle('Property')
    va = g.add_line(asset, aproperty)

    business = g.add_circle('Business')
    va = g.add_line(organisation, business)
    va = g.add_line(asset, business)

    employee = g.add_circle('Employee')
    va = g.add_line(person, employee)
    va = g.add_line(asset, employee)

    policy = g.add_circle('Policy')
    pp = g.add_line(product, policy)
    pm = g.add_line(member, policy)
    pb = g.add_line(benefit, policy)
    pi = g.add_line(inter, policy)
    pv = g.add_line(vehicle, policy)
    pv = g.add_line(aproperty, policy)
    pv = g.add_line(business, policy)
    pv = g.add_line(employee, policy)

    pbenefit = g.add_circle('Policy Benefit')
    pp = g.add_line(benefit, pbenefit)
    pp = g.add_line(policy, pbenefit)

    claim = g.add_circle('Claim')
    cp = g.add_line(policy, claim)

    claimitem = g.add_circle('Claim Item')
    ci = g.add_line(claim, claimitem)
    pi = g.add_line(pbenefit, claimitem)

    tariff = g.add_circle('Tariff')
    tariffline = g.add_circle('Tariff Item')
    tt = g.add_line(tariff, tariffline)
    tt = g.add_line(tariffline, claimitem)

    transaction = g.add_circle('Transactions')
    pt = g.add_line(policy, transaction)
    pc = g.add_line(claim, transaction)
    """

    path = g.draw('rocket.png')
