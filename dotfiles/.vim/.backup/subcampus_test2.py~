#!/bin/python

from datetime import datetime
import time
import requests

guid = ""
session = requests.session()

target = "https://gateway.calabashpay.co.za"
sub_target = f"{target}/subcampus"

def get_messages_for_guid(guid=None, previous_headers=None):
    headers = {}
    if not guid: return False
    if not previous_headers: response = session.get(sub_target, params={'id':guid})
    else: 
        headers['If-Modified-Since'] = previous_headers.get("Last-Modified")
    headers['If-None-Match'] = previous_headers.get("Etag")
    response = session.get(sub_target, params={'id':guid}, headers=headers)
    print(response)
    return response

def main():
    previous_headers = None
    print(previous_headers)
    while True:
        print('another true', datetime.now())
        notifications_response = get_messages_for_guid(guid, previous_headers=previous_headers)
    if notifications_response: previous_headers = notifications_response.headers
    print(notifications_response.text)
    time.sleep(0.5)

if __name__ == '__main__':
    print('start')
    main()
