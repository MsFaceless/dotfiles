#!/bin/python

import logging

from tg import expose

from calabash.model import *

from calabash.lib.html_utils import *
from calabash.lib.base import BaseController
from calabash.lib.tg_decorators import safe_headers, time_it
from calabash.lib.myimali_api_gateway import MyImaliApiGateway

from calabash.controllers.common import CommonController

import calabash.lib.vault_utils as VAULT

COMMON = CommonController()
MYIMALI = MyImaliApiGateway()

LOGGER = logging.getLogger(__name__)

class CardController(BaseController):

    @safe_headers
    @expose('json')
    def add_card(self, *args, **kwargs):
        result = MYIMALI.add_card(**kwargs)
        success = result.get('success', False)
        if not success:
            return error_response()
        return success_response()

    @safe_headers
    @expose('json')
    def get_card_details(self, *args, **kwargs):
        result = MYIMALI.get_card_details(**kwargs)
        success = result.get('success', False)
        if not success:
            error = result.get('error', '')
            return error_response(error)
        return success_response()

    @safe_headers
    @expose('json')
    def get_card_transactions(self, *args, **kwargs):
        result = MYIMALI.get_card_transactions(**kwargs)
        success = result.get('success', False)
        if not success:
            error = result.get('error', '')
            return error_response(error)
        return success_response()

    @safe_headers
    @expose('json')
    def replace_card(self, *args, **kwargs):
        result = MYIMALI.replace_card(**kwargs)
        success = result.get('success', False)
        if not success:
            error = result.get('error', '')
            return error_response(error)
        return success_response()

    @safe_headers
    @expose('json')
    def update_card_status(self, *args, **kwargs):
        result = MYIMALI.update_card_status(**kwargs)
        success = result.get('success', False)
        if not success:
            error = result.get('error', '')
            return error_response(error)
        return success_response()

    @safe_headers
    @expose('json')
    def payout_to_card(self, *args, **kwargs):
        result = MYIMALI.payout_to_card(**kwargs)
        success = result.get('success', False)
        if not success:
            error = result.get('error', '')
            return error_response(error)
        return success_response()
