# -*- coding: utf-8 -*-
"""PaymentController controller module"""

import os
import json
from datetime import datetime
from sqlalchemy import func, desc, asc
from pkg_resources import resource_filename
from tg import expose, require, redirect, validate, flash, url, request, response, predicates

from eiffel_back.model import *
from eiffel_back.lib.tg_utils import *
from eiffel_back.lib.base import BaseController
from eiffel_back.lib.tg_decorators import *
from eiffel_back.lib.tgfileuploader import FileUploader
from eiffel_back.lib.tg_generic_reportlab import PDFCreator, Paragraph

FILENAME = os.path.abspath(resource_filename('eiffel_back', 'public'))
PUBLIC_DIRNAME = os.path.join(FILENAME)
PDF_DIRNAME = os.path.join(PUBLIC_DIRNAME, 'pdf')
IMAGES_DIRNAME = os.path.join(PUBLIC_DIRNAME, 'images')
CATALOG_DIRNAME = os.path.join(IMAGES_DIRNAME, 'catalog_pictures')

__all__ = ['PaymentController']

class PaymentController(BaseController):

    @require(CustomNotAnonymous())
    @expose('eiffel_back.templates.generic')
    def index(self, *args, **kwargs):
        usernow = request.identity.get('user', {})
        title = "All Payments"
        htmltbl = self.get_payments_htmltbl(**kwargs)
        html = f"""
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-primary card-header-icon">
                        <div class="card-icon">
                            <i class="material-icons">money</i>
                        </div>
                        <h4 class="card-title">Payments</h4>
                    </div>
                    <div class="card-body">
                        <div class="toolbar">
                        </div>
                        <div class="material-datatables">
                            {htmltbl}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        """
        javascript = """
        """
        return dict(title=title, html=html, javascript=javascript)

    def get_payments_htmltbl(self, *args, **kwargs):
        outputlist = []
        dbase_query = []
        for item in dbase_query:
            outputlist.append({
                'name': '',
                'student_number': '',
                'last_active': '',
                'actions': '',
                             })
        dbcolumnlist=[
                'name',
                'student_number',
                'last_active',
                'actions',
                    ]
        theadlist=[
                'Name',
                'Student No.',
                'Last Active',
                'Actions'
                ]
        tdclasslist = [
                ]
        return build_html_table_material(outputlist, dbcolumnlist, theadlist, "allpayments", tdclasslist)
