import time
import requests

session = requests.session()

target = "https://testing.calabashpay.co.za"
sub_target = f"{target}/subpublic"

def get_messages(previous_headers=None):
    headers = {}
    params = {'id':'public'}
    if not previous_headers: response = session.get(sub_target, params=params)
    else: 
        headers['If-Modified-Since'] = previous_headers.get("Last-Modified")
        headers['If-None-Match'] = previous_headers.get("Etag")
        response = session.get(sub_target, headers=headers, params=params)
    return response

def main():
    previous_headers = None
    while True:
        print('another true')
        notifications_response = get_messages(previous_headers=previous_headers)
        if notifications_response: previous_headers = notifications_response.headers
        else: pass
        print(notifications_response.text)
        time.sleep(0.5)

if __name__ == '__main__':
    print('here')
    main()
