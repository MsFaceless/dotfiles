# -*- coding: utf-8 -*-

import os
from datetime import datetime
from hashlib import sha256

from sqlalchemy import Table, ForeignKey, Column
from sqlalchemy.types import Unicode, Integer, DateTime, Boolean
from sqlalchemy.orm import relation, synonym

from rocket.model import DeclarativeBase, metadata, DBSession
from rocket.lib.model_utils import PhatBase, common_columns, get_type_table, get_phat_table

# ---------------------------- Process -----------------------------------

columns_tbl_process_type = {
    '__tablename__': 'tbl_process_type',
    'name': common_columns.get('title_not_nullable')(),
}
ProcessType = get_phat_table(model_name='ProcessType', columndict=columns_tbl_process_type)
# ProcessType = get_type_table(model_name='Process', table_name='process')

columns_tbl_process = {
    '__tablename__': 'tbl_process',
    'code': common_columns.get('title_not_nullable')(),
    'name': common_columns.get('description_not_nullable')(),
    'process_type_id': common_columns.get('integer_not_nullable')(),
    'start_date': common_columns.get('date')(),
    'end_date': common_columns.get('date')(),
}
Process = get_phat_table(model_name='Process', columndict=columns_tbl_process)

ProcessStateTimeoutType = get_type_table(model_name='ProcessStateTimeout', table_name='process_state_timeout')
# Move to an Alternative State, Escalate.

columns_tbl_process_state_timeout_destination = {
    '__tablename__': 'tbl_process_state_timeout_destination',
    'process_state_id': common_columns.get('integer_not_nullable')(),
    'destination_process_state_id': common_columns.get('integer_not_nullable')(),
}
ProcessStateTimeoutDestination = get_phat_table(model_name='ProcessStateTimeoutDestination', columndict=columns_tbl_process_state_timeout_destination)

tbl_process_state = {
    '__tablename__': 'tbl_process_state',
    'process_id': common_columns.get('integer_not_nullable')(),
    'sequence': common_columns.get('integer_not_nullable')(),
    'name': common_columns.get('title_not_nullable')(),
    'timeout': common_columns.get('integer_not_nullable')(),
    'process_state_timeout_type_id': common_columns.get('integer_not_nullable')(),
    'is_start': common_columns.get('boolean_default_false')(),
    'is_process': common_columns.get('boolean_default_false')(),
    'is_escalate': common_columns.get('boolean_default_false')(),
    'is_end': common_columns.get('boolean_default_false')(),
    'is_locked': common_columns.get('boolean_default_false')(),
    }
ProcessState = get_phat_table(model_name='ProcessState', columndict=tbl_process_state)

tbl_process_state_action = {
    '__tablename__': 'tbl_process_state_action',
    'process_state_id': common_columns.get('integer_not_nullable')(),
    'sequence': common_columns.get('integer_not_nullable')(),
    'action': common_columns.get('description_not_nullable')(),
    'is_mandatory': common_columns.get('boolean_default_false')(),
    }
ProcessStateAction = get_phat_table(model_name='ProcessStateAction', columndict=tbl_process_state_action)

tbl_process_team = {
    '__tablename__': 'tbl_process_team',
    'process_id': common_columns.get('integer_not_nullable')(),
    'user_id': common_columns.get('integer_not_nullable')(),
    }
ProcessTeam = get_phat_table(model_name='ProcessTeam', columndict=tbl_process_team)

tbl_process_team_state = {
    '__tablename__': 'tbl_process_team_state',
    'process_team_id': common_columns.get('integer_not_nullable')(),
    'process_state_id': common_columns.get('integer_not_nullable')(),
    }
ProcessTeamState = get_phat_table(model_name='ProcessTeamState', columndict=tbl_process_team_state)

# ---------------------------- Lead Process -----------------------------------

tbl_lead_process_state = {
    '__tablename__': 'tbl_lead_process_state',
    'lead_id': common_columns.get('integer_not_nullable')(),
    'process_state_id': common_columns.get('integer_not_nullable')(),
    'current': common_columns.get('boolean_default_false')(),
    }
LeadProcessState = get_phat_table(model_name='LeadProcessState', columndict=tbl_lead_process_state)

tbl_lead_process_state_action = {
    '__tablename__': 'tbl_lead_process_state_action',
    'lead_process_state_id': common_columns.get('integer_not_nullable')(),
    'process_state_action_id': common_columns.get('integer_not_nullable')(),
    'is_completed': common_columns.get('boolean_default_false')(),
    'completed_by': common_columns.get('integer')(),
    'completed_on': common_columns.get('datetime')(),
    }
LeadProcessStateAction = get_phat_table(model_name='LeadProcessStateAction', columndict=tbl_lead_process_state_action)

tbl_lead_process_state_team_member = {
    '__tablename__': 'tbl_lead_process_state_team_member',
    'lead_process_state_id': common_columns.get('integer_not_nullable')(),
    'process_team_id': common_columns.get('integer_not_nullable')(),
    }
LeadProcessStateTeamMember = get_phat_table(model_name='LeadProcessStateTeamMember', columndict=tbl_lead_process_state_team_member)



