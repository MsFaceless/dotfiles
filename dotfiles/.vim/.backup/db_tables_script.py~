import mysql.connector
from mysql.connector import Error
from tabulate import tabulate


try:
    connection = mysql.connector.connect(
        host='localhost',
        database='rocketdb',
        user='root',
        password='developpass',
        charset='utf8',
    )
    sql_tables_query = "show tables;"
    cursor = connection.cursor()
    cursor.execute(sql_tables_query)
    records = cursor.fetchall()

    file_object = open('rocket_tables.md', 'a')


    for row in records:
        table_name = row[0]

        # column_names = f"show columns from {table_name};"
        # cursor.execute(column_names)
        # column_records = cursor.fetchall()
        # col_list = [(col[0]).title() for col in column_records]
        if table_name[0:6] == 'audit_':
            continue
        
        file_object.write(f'\n\n- {table_name}\n')

        if table_name[-5:] == '_type':
            describe = f"select * from {table_name};"
            select_cursor = connection.cursor(dictionary=True)
            select_cursor.execute(describe)
            type_records = select_cursor.fetchall()
            output = tabulate(type_records, headers="keys", tablefmt='psql')
            file_object.write(output)
        else:
            describe = f"describe {table_name};"
            cursor.execute(describe)
            model = cursor.fetchall()
            output = tabulate(model, headers=['Field', 'Type', 'Null', 'Key', 'Default', 'Extra'], tablefmt='psql')
            file_object.write(output)
    
    file_object.close()

except Error as e:
    print("Error reading data from MySQL table", e)
finally:
    if (connection.is_connected()):
        connection.close()
        cursor.close()
        print("MySQL connection is closed")
