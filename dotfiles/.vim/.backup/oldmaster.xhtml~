        <script py:if="request.identity">


            var notificationCounts = $('#notificationCounts');
            <![CDATA[
                function get_set_counts(){
                    $.get('/my_account/get_unread_notifications', function(data){
                        var result = JSON.parse(data);
                        //console.log(result);

                        var new_notification_count = result.notification_count;
                        var current_notification_count = notificationCounts.data('notifications');
                        if(new_notification_count != current_notification_count){
                            notificationCounts.data('notifications', new_notification_count);
                            //$(document).trigger('notification-counts-changed');
                            //$(document).trigger('notifications-changed');
                            console.log('master.xhtml line 206 show the notifications now, count is:', new_notification_count)
                        };

                        var new_chat_count = result.chat_count;
                        var current_chat_count = notificationCounts.data('chats');
                        if(new_chat_count != current_chat_count){
                            notificationCounts.data('chats', new_chat_count);
                            $(document).trigger('chat-counts-changed');
                            $(document).trigger('notifications-changed');

                        }

                        // Known bug: this div does not show as empty unless you refresh the page even after the rating_modal is closed
                        var dialogdiv_empty = $('#dialogdiv').is(':empty');
                        if(result.rating_post_id != null && dialogdiv_empty){
                            var kwargs = 'post_id='+result.rating_post_id;
                            $('#dialogdiv').load('/my_account/get_rating_modal', kwargs, function(data){
                                return false;
                            });

                        };
                        return false;
                    });
                };

                $(document).on('notifications-changed', function() {

                    var notification_count = notificationCounts.data('notifications');
                    var message_count = notificationCounts.data('chats');
                    var sum_count = notification_count + message_count;
                    var total_count = (sum_count === 0) ? "" : sum_count;
                    //if (total_count){
                    if (message_count){
                        $('#notifMain').addClass('font-weight-bold');
                        $('#notifMainBadge').text(total_count).addClass('flash');

                    } else {
                        $('#notifMain').removeClass('font-weight-bold');
                        $('#notifMainBadge').text('');
                    };

                });

                //get_set_counts();
                //setInterval(get_set_counts, 3000);
            ]]>
        </script>
    </body>
</html>
