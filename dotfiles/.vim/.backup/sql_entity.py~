# -*- coding: utf-8 -*-

import os
from datetime import datetime
from hashlib import sha256

from sqlalchemy import Table, ForeignKey, Column
from sqlalchemy.types import Unicode, Integer, DateTime, Boolean
from sqlalchemy.orm import relation, synonym

from rocket.model import DeclarativeBase, metadata, DBSession
from rocket.lib.model_utils import PhatBase, common_columns, get_phat_table, get_type_table

# ********************* Entity Types ***********************************#

EntityType = get_type_table(model_name='Entity', table_name='entity')

EntityAddressType = get_type_table(model_name='EntityAddress', table_name='entity_address')
EntityBankAccountType = get_type_table(model_name='EntityBankAccount', table_name='entity_bank_account')
EntityContactType = get_type_table(model_name='EntityContact', table_name='entity_contact')

EntityOrganisationType = get_type_table(model_name='EntityOrganisation', table_name='entity_organisation')

EntityPersonIdentityType = get_type_table(model_name='EntityPersonIdentity', table_name='entity_person_identity')
EntityPersonGenderType =get_type_table(model_name='EntityPersonGender', table_name='entity_person_gender')
EntityPersonMaritalStatusType =get_type_table(model_name='EntityPersonMaritalStatus', table_name='entity_person_marital_status')


# ********************* Entity ***********************************#

tbl_entity = {
        '__tablename__': 'tbl_entity',
        'entity_type_id': common_columns.get('integer_not_nullable')(),
}
Entity = get_phat_table(model_name='Entity', columndict=tbl_entity)

tbl_entity_organisation = {
    '__tablename__': 'tbl_entity_organisation',
    'entity_id': common_columns.get('integer_not_nullable')(),
    'entity_organisation_type_id': common_columns.get('integer_not_nullable')(),
    'code': common_columns.get('description_not_nullable')(),
    'name': common_columns.get('description_not_nullable')(),
    'tax_number': common_columns.get('description_not_nullable')(),
    'registration_number': common_columns.get('description_not_nullable')(),
    'financial_regulatory_number': common_columns.get('description')()
}
EntityOrganisation = get_phat_table(model_name='EntityOrganisation', columndict=tbl_entity_organisation)

tbl_entity_contact = {
    '__tablename__': 'tbl_entity_contact',
    'entity_id': common_columns.get('integer_not_nullable')(),
    'entity_contact_type_id': common_columns.get('integer_not_nullable')(),
    'name': common_columns.get('description')(),
    'value': common_columns.get('description_not_nullable')(),
    'preferred': common_columns.get('boolean_default_false')(),
}
EntityContact = get_phat_table(model_name='EntityContact', columndict=tbl_entity_contact)

tbl_entity_bankaccount = {
    '__tablename__': 'tbl_entity_bankaccount',
    'entity_id': common_columns.get('integer_not_nullable')(),
    'bank_id':common_columns.get('integer_not_nullable')(),
    'bank_account_type_id':common_columns.get('integer_not_nullable')(),
    'swift_code':common_columns.get('title')(),
    'account_number':common_columns.get('title_not_nullable')(),
    'account_holder':common_columns.get('title_not_nullable')(),
    'branch_code':common_columns.get('title_not_nullable')(),
    'currency_id':common_columns.get('integer_not_nullable')(),
    'iban':common_columns.get('title')(),
}
EntityBankAccount = get_phat_table(model_name='EntityBankAccount', columndict=tbl_entity_bankaccount)

tbl_entity_address = {
    '__tablename__': 'tbl_entity_address',
    'entity_id': common_columns.get('integer_not_nullable')(),
    'entity_address_type_id': common_columns.get('integer_not_nullable')(),
    'address_line':common_columns.get('title_not_nullable')(),
    'city':common_columns.get('title')(),
    'postal_code':common_columns.get('title')(),
    'country_id':common_columns.get('integer_not_nullable')(),
    'region_id':common_columns.get('integer_not_nullable')(),
    'district_id':common_columns.get('integer_not_nullable')(),
    'centre_id':common_columns.get('integer_not_nullable')(),
    'latitude':common_columns.get('geocoord')(),
    'longitude':common_columns.get('geocoord')(),
    'w3w':common_columns.get('description')(),
    }
EntityAddress = get_phat_table(model_name='EntityAddress', columndict=tbl_entity_address)

# ********************* Entity Organisation Client ***********************************#

tbl_entity_organisation_client = {
        '__tablename__': 'tbl_entity_organisation_client',
        'entity_organisation_id': common_columns.get('integer_not_nullable')(),
        'billing_frequency_type_id': common_columns.get('integer_not_nullable')(),
}
EntityOrganisationClient = get_phat_table(model_name='EntityOrganisationClient', columndict=tbl_entity_organisation_client)

tbl_entity_organisation_client_person_link = {
        '__tablename__': 'tbl_entity_organisation_client_person_link',
        'entity_organisation_client_id': common_columns.get('integer_not_nullable')(),
        'entity_person_id': common_columns.get('integer_not_nullable')(),
}
EntityOrganisationClientPersonLink = get_phat_table(model_name='EntityOrganisationClientPersonLink', columndict=tbl_entity_organisation_client_person_link)

# ********************* Entity Organisation Product Owner ***********************************#

tbl_entity_organisation_product_owner = {
        '__tablename__': 'tbl_entity_organisation_product_owner',
        'entity_organisation_id': common_columns.get('integer_not_nullable')(),
        'policy_number_prefix': common_columns.get('description')(),
}
EntityOrganisationProductOwner = get_phat_table(model_name='EntityOrganisationProductOwner', columndict=tbl_entity_organisation_product_owner)

# ********************* Entity Organisation Insurer ***********************************#

tbl_entity_organisation_insurer = {
        '__tablename__': 'tbl_entity_organisation_insurer',
        'entity_organisation_id': common_columns.get('integer_not_nullable')(),
}
EntityOrganisationInsurer = get_phat_table(model_name='EntityOrganisationInsurer', columndict=tbl_entity_organisation_insurer)

# ********************* Entity Organisation Intermediary ***********************************#

tbl_entity_organisation_intermediary = {
    '__tablename__': 'tbl_entity_organisation_intermediary',
    'entity_id': common_columns.get('integer_not_nullable')(),
    'code': common_columns.get('title_not_nullable')(),
    'financial_regulatory_number': common_columns.get('title_not_nullable')(),
    'manager_entity_organisation_intermediary_id': common_columns.get('integer')(),
    'entity_organisation_intermediary_role_id': common_columns.get('integer_not_nullable')(),
    'from_date': common_columns.get('date')(),
    'to_date': common_columns.get('date')(),
    'pay_level': common_columns.get('boolean_default_true')(),
    'campaign_id': common_columns.get('integer')(),
}
EntityOrganisationIntermediary = get_phat_table(model_name='EntityOrganisationIntermediary', columndict=tbl_entity_organisation_intermediary)

tbl_entity_organisation_intermediary_role = {
    '__tablename__': 'tbl_entity_organisation_intermediary_role',
    'name': common_columns.get('title_not_nullable')(),
    'description': common_columns.get('description')(),
}
EntityOrganisationIntermediaryRole = get_phat_table(model_name='EntityOrganisationIntermediaryRole', columndict=tbl_entity_organisation_intermediary_role)

tbl_entity_organisation_intermediary_note = {
    '__tablename__': 'tbl_entity_organisation_intermediary_note',
    'entity_organisation_intermediary_id': common_columns.get('integer_not_nullable')(),
    'text': common_columns.get('description_not_nullable')(),
}
EntityOrganisationIntermediaryNote = get_phat_table(model_name='EntityOrganisationIntermediaryNote', columndict=tbl_entity_organisation_intermediary_note)

# ********************* Entity Organisation Service Provider ***********************************#

tbl_entity_organisation_service_provider = {
    '__tablename__': 'tbl_entity_organisation_service_provider',
    'entity_organisation_id': common_columns.get('integer_not_nullable')(),
    'category_id': common_columns.get('integer_not_nullable')(),
    'sub_category_id': common_columns.get('integer_not_nullable')(),
}
EntityOrganisationServiceProvider = get_phat_table(model_name='EntityOrganisationServiceProvider', columndict=tbl_entity_organisation_service_provider)

tbl_service_provider_category = {
    '__tablename__': 'tbl_service_provider_category',
    'name': common_columns.get('title_not_nullable')(),
    'description': common_columns.get('description')(),
}
ServiceProviderCategory = get_phat_table(model_name='ServiceProviderCategory', columndict=tbl_service_provider_category)

tbl_service_provider_subcategory = {
    '__tablename__': 'tbl_service_provider_subcategory',
    'category_id': common_columns.get('integer_not_nullable')(),
    'name': common_columns.get('title_not_nullable')(),
    'description': common_columns.get('description')(),
}
ServiceProviderSubcategory = get_phat_table(model_name='ServiceProviderSubcategory', columndict=tbl_service_provider_subcategory)

# ********************* Entity Organisation Payment Provider ***********************************#

tbl_entity_organisation_payment_provider = {
    '__tablename__': 'tbl_entity_organisation_payment_provider',
    'entity_organisation_id': common_columns.get('integer_not_nullable')(),
    'reference_number': common_columns.get('description_not_nullable')(),
}
EntityOrganisationPaymentProvider = get_phat_table(model_name='EntityOrganisationPaymentProvider', columndict=tbl_entity_organisation_payment_provider)

# ********************* Entity Person ***********************************#

tbl_entity_person = {
    '__tablename__': 'tbl_entity_person',
    'surname':common_columns.get('title_not_nullable')(),
    'firstname':common_columns.get('title_not_nullable')(),
    'preferred_name':common_columns.get('title')(),
    'entity_id':common_columns.get('integer_not_nullable')(),
    'entity_person_gender_type_id':common_columns.get('integer_not_nullable')(),
    'entity_person_title_id':common_columns.get('integer_not_nullable')(),
    'language_id':common_columns.get('integer_not_nullable')(),
    'date_of_birth':common_columns.get('date_not_nullable')(),
    'preferred': common_columns.get('boolean_default_false')(),
}
EntityPerson = get_phat_table(model_name='EntityPerson', columndict=tbl_entity_person)

tbl_entity_person_title = {
        '__tablename__': 'tbl_entity_person_title',
        'title': common_columns.get('title_not_nullable')(),
        'description': common_columns.get('description_not_nullable')(),
        }
EntityPersonTitle = get_phat_table(model_name='EntityPersonTitle', columndict=tbl_entity_person_title)

tbl_entity_person_identity = {
        '__tablename__': 'tbl_entity_person_identity',
        'entity_person_identity_type_id': common_columns.get('integer_not_nullable')(),
        'value': common_columns.get('title_not_nullable')(),
        'entity_person_id': common_columns.get('integer_not_nullable')(),
        'expiry_date': common_columns.get('date')(),
        }
EntityPersonIdentity = get_phat_table(model_name='EntityPersonIdentity', columndict=tbl_entity_person_identity)

tbl_entity_person_relationship_link = {
        '__tablename__': 'tbl_entity_person_relationship_link',
        'entity_person_id': common_columns.get('integer_not_nullable')(),
        'relation_entity_person_id': common_columns.get('integer_not_nullable')(),
        'relationship_type_id': common_columns.get('integer_not_nullable')(),
        'is_beneficiary': common_columns.get('boolean_default_false')(),
        }
EntityPersonRelationshipLink = get_phat_table(model_name='EntityPersonRelationshipLink', columndict=tbl_entity_person_relationship_link)

tbl_entity_person_family = {
    '__tablename__': 'tbl_entity_person_family',
    'entity_person_id': common_columns.get('integer')(),
    'family_entity_person_id': common_columns.get('integer')(),
    'relationship_type_id': common_columns.get('integer')()
}
EntityPersonFamily = get_phat_table(model_name='EntityPersonFamily', columndict=tbl_entity_person_family)

tbl_entity_person_client = {
    '__tablename__': 'tbl_entity_person_client',
    'entity_person_id': common_columns.get('integer')(),
    'entity_organisation_client_id': common_columns.get('integer')()
}
EntityPersonClient = get_phat_table(model_name='EntityPersonClient', columndict=tbl_entity_person_client)
