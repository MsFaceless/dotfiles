from tg import redirect, lurl, request

def get_onload_script(title='Title'):
    return onload_script

def wrap_master(title=None, html='', script='', *args, **kw):
    if not title: return False
    if not html: return False
    pushstate_script = f"""
        history.pushState("{title}", "", "{request.environ.get("PATH_INFO")}");
        document.title = "{title}";
        """
    script = script + pushstate_script
    master = f"""
    <!DOCTYPE html>
    <html>
        <head>
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

            <script src='/javascript/jquery-3.3.1.min.js'></script>

            <link href="https://fonts.googleapis.com/css?family=Montserrat: 400, 700, 200" rel="stylesheet" />
            <link href="/css/font-awesome.css" rel="stylesheet" />
            <link href="/css/bootstrap.min.css" rel="stylesheet" />
            <link href="/css/now-ui-dashboard.css" rel="stylesheet" />
            <link href="/css/dropzone.css" rel="stylesheet" />
            <link href="/css/style.css" rel="stylesheet" />
            <!--link href="/css/bulma.css" rel="stylesheet" /-->

            <title>{title}</title>
        </head>
        <body class="sidebar-mini">

            <!-- Wrapper start -->
            <div class="wrapper">

                <!-- Sidebar start -->
                <div class="sidebar" data-color="orange"> </div>
                <!-- Sidebar end -->

                <!-- Main panel start -->
                <div class="main-panel" id="main-panel">

                    <!-- Navbar start -->
                    <nav class="navbar navbar-expand-lg navbar-transparent bg-primary navbar-absolute">
                        <div class="container-fluid">
                          <div class="navbar-wrapper">
                            <div class="navbar-toggle">
                              <button type="button" class="navbar-toggler">
                                <span class="navbar-toggler-bar bar1"></span>
                                <span class="navbar-toggler-bar bar2"></span>
                                <span class="navbar-toggler-bar bar3"></span>
                              </button>
                            </div>
                          </div>
                          <button class="navbar-toggler" type="button"
                                  data-toggle="collapse" data-target="#navigation"
                                  aria-controls="navigation-index" aria-expanded="false"
                                  aria-label="Toggle navigation" >
                            <span class="navbar-toggler-bar navbar-kebab"></span>
                            <span class="navbar-toggler-bar navbar-kebab"></span>
                            <span class="navbar-toggler-bar navbar-kebab"></span>
                          </button>
                        </div>
                    </nav>
                    <!-- Navbar end -->

                    <!-- Header panel start -->
                    <div class="panel-header panel-header-sm"></div>
                    <!-- Header panel end -->

                    <!-- Content -->
                    <div id="contentcontainer" class="content">
                        {html}
                    </div>

                    <!-- Footer -->
                    <footer class='footer'>
                        <div class="copyright" id="copyright">
                            &copy; 2020 Powered by
                            <a href="http: //www.rocketinsurtech.com" target="_blank">rocket insurtech</a>.
                        </div>
                    </footer>

                </div>
                <!-- Main panel end -->
                <div id="dialogdiv"></div>

            </div>
            <!-- Wrapper end -->
              <!-- Core JS Files -->
              <script src="/javascript/jquery.min.js"></script>
              <script src="/javascript/popper.min.js"></script>
              <script src="/javascript/bootstrap.min.js"></script>
              <script src="/javascript/jquery-ui.js"></script>
              <script src="/javascript/jquery.redirect.js"></script>
              <script src="/javascript/jquery_utils.js"></script>
              <script src="/javascript/moment.min.js"></script>

              <!--  Plugin for Switches, full documentation here: http: //www.jque.re/plugins/version3/bootstrap.switch/ -->
              <!-- <script src="/javascript/bootstrap-switch.js"></script> -->

              <!--  Plugin for Sweet Alert -->
              <script src="/javascript/sweetalert2.min.js"></script>

              <!-- Forms Validations Plugin -->
              <script src="/javascript/jquery.validate.min.js"></script>

              <!--  Plugin for the Wizard, full documentation here: https: //github.com/VinceG/twitter-bootstrap-wizard -->
              <script src="/javascript/jquery.bootstrap-wizard.js"></script>

              <!--	Plugin for Select, full documentation here: http: //silviomoreto.github.io/bootstrap-select -->
              <script src="/javascript/bootstrap-selectpicker.js"></script>

              <!--  Plugin for the DateTimePicker, full documentation here: https: //eonasdan.github.io/bootstrap-datetimepicker/ -->
              <script src="/javascript/bootstrap-datetimepicker.js"></script>

              <!--  DataTables.net Plugin, full documentation here: https: //datatables.net/    -->
              <script src="/javascript/jquery.dataTables.min.js"></script>

              <!--	Plugin for Tags, full documentation here: https: //github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
              <script src="/javascript/bootstrap-tagsinput.js"></script>

              <!-- Plugin for Fileupload, full documentation here: http: //www.jasny.net/bootstrap/javascript/#fileinput -->
              <script src="/javascript/jasny-bootstrap.min.js"></script>

              <!--  Full Calendar Plugin, full documentation here: https: //github.com/fullcalendar/fullcalendar    -->
              <script src="/javascript/fullcalendar.min.js"></script>

              <!-- Vector Map plugin, full documentation here: http: //jvectormap.com/documentation/ -->
              <script src="/javascript/jquery-jvectormap.js"></script>

              <!--  Plugin for the Sliders, full documentation here: http: //refreshless.com/nouislider/ -->
              <script src="/javascript/nouislider.min.js"></script>

              <!--  Charts Plugin -->
              <script src="/javascript/chartist.min.js"></script>

              <!-- Chart JS -->
              <script src="/javascript/chartjs.min.js"></script>

              <!-- Circle Percentage-chart -->
              <script src="/javascript/jquery.easypiechart.min.js"></script>

              <!--  Notifications Plugin    -->
              <script src="/javascript/bootstrap-notify.js"></script>

              <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example titles etc -->
              <script src="/javascript/now-ui-dashboard.min.js" type="text/javascript"></script>

              <!-- Dropzone File upload plugin -->
              <script src="/javascript/dropzone.js" ></script>
              <script type='text/javascript'>
                  Dropzone.autoDiscover = false;
                  focusOnInput(); // from public/javascript/jquery_utils.js
                  $('.sidebar').load('/get_sidebar_html', function(data){{ return false; }});
                  {script}
              </script>
        </body>
    </html>
    """
    return master

def generate_login_modal():
    html = """
        <div id="modal" class="modal has-text-black is-active is-dark has-text-centered">
            <div class="modal-background"></div>
            <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Login</p>
            </header>
            <section class="modal-card-body">
                <form id="login_form" accept-charset="UTF-8" class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Username: </label>
                        <div class="col-sm-12">
                            <input class="form-control" type="text" name="login" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Password: </label>
                        <div class="col-sm-12">
                            <input class="form-control" type="password" name="password" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-12 col-sm-offset-2">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="remember" value="1" /> remember me
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </section>
            <footer class="modal-card-foot">
                <button id='submit_login' class="button is-primary is-small">Login</button>
                <button id="cancel_btn" class="button is-small">Cancel</button>
            </footer>
        </div>
    </div>
    """
    javascript = """
    <script>
        $(".sidebar").hide();
        $('#cancel_btn').click(function(){
            $('#modal').toggleClass('is-active');
        });
        $('#submit_login').click(function(){
            var formserial = $("#login_form").serialize();
            $.post("/login_handler?", formserial, function(){
                location.reload();
                $(".sidebar").show();
                return false;
            });
        });
    </script>
    """
    return html + javascript

def get_login_page(came_from=lurl('/')):
    pushstate_script = f"""
        history.pushState("Rocket Login", "", "{came_from}");
        document.title = "Rocket Login";
    """
    login_page = f"""
    <html>
    <head>
        <title></title>
        <link rel="stylesheet" href='/css/bootstrap.min.css'/>
        <link rel="stylesheet" href='/css/font-awesome.css'/>
        <link rel="stylesheet" href='/css/login.css'/>
        <script src='/javascript/jquery-3.3.1.min.js'></script>
    </head>
    <body>
        <div class="logo">
            <div class="logo-text">R<span class="orange-o">O</span>CKET</div>
            <div class="logo-banner"> Insurtech </div>
        </div>
        <div class="login-box">
            <div class="container">
                <div class="d-flex justify-content-center h-100">
                    <div class="card">
                        <div class="card-header"> <h3>Sign In</h3> </div>
                        <div class="card-body">
                            <form id="login_form">
                                <div class="input-group form-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                                    </div>
                                    <input class="form-control" type="text" name="login" placeholder="username" autofocus="autofocus" value=""/>
                                </div>
                                <div class="input-group form-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                                    </div>
                                    <input class="form-control" type="password" name="password" placeholder="password"/>
                                </div>
                                <div class="row align-items-center remember">
                                    <input type="checkbox" name="remember" value="1" /> remember me
                                </div>
                            </form>
                            <div class="form-group">
                                <button id="login_button" class="btn float-right action_btn">Login</button>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="d-flex justify-content-center links">
                            </div>
                            <div class="d-flex justify-content-center">
                                <a class="login-link" href="/useraccess/forgot">Forgot your password?</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            {pushstate_script}
            $("#login_button").click(function(){{
                var formserial = $("#login_form").serialize();
                $.post("/login_handler?", formserial, function(){{
                    location.reload();
                    return false;
                }});
                return false;
            }});
            $(document).keypress(function(e) {{
                if(e.which == 13) {{
                    $('#login_button').trigger('click');
                }}
            }});
        </script>
    </body>
    </html>
    """
    return login_page

def check_user_login_redirect(request):
    if not is_user(request): login_redirect(request)


def login_redirect(request, failure=None, login=''):
    came_from = request.environ.get("PATH_INFO")
    extra_params = {
        'came_from': came_from,
        'failure': failure,
        'login': login,
        }
    redirect('/login', extra_params)

def is_user(request):
    if not request: return False
    identity = None
    if hasattr(request, 'identity'): identity = request.identity
    usernow = None
    username = None
    if identity: usernow = request.identity.get('user', {})
    if hasattr(usernow, 'username'):
        username = getattr(usernow, 'username')
        display =  getattr(usernow, 'name')
        userid = getattr(usernow, 'id')
    if username: return {'user_id': userid, 'user_name': username, 'display_name': display}

class Card(object):
    def __init__(self, *args, **kwargs):
        pass

    def __repr__(self, *meow):
        return "MEOW"

    def set_card_name(self, card_name=None):
        if not card_name: return False
        if not isinstance(card_name, str): return False
        setattr(self, 'card_name', card_name)
        return True

    def set_size_fullwidth(self):
        setattr(self, 'card_size', '12')
        return True

    def set_size_halfwidth(self):
        setattr(self, 'card_size', '6')
        return True

    def set_size_thirdwidth(self):
        setattr(self, 'card_size', '4')
        return True

    def set_size_quarterwidth(self):
        setattr(self, 'card_size', '3')
        return True



def wrap_card(**kwargs):
    card_name = kwargs.get("card_name", None)

    card_html = f"""
        <div class="col-md-12">
            <div class="card">
            <div class="card-header">
                <div class="row d-flex">
                    <div class="col-md-6">
                        <h4 class="card-title">{title}</h4>
                    </div>
                    <div class="col-md-6 text-right">
                        <a href='/'><button id="create_new_product" class="btn btn-primary ml-auto">Go Home</button></a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <h4>An Error has Occurred.</h4>
                <h5> Please <button id='reload_button' class='btn'>Refresh</button> the page or <a href="/"><button class='btn'>Return Home</button></a></h5>
                <h5> Alternatively feel free to contact our <button id='fhankyoubtn' class='btn'>Support Team</button></h5>
                <img id='fhankyou' src="/img/middle.webp" style="display: none"></img>
            </div>
        </div>
        """
    return card_html

def wrap_card_fullwidth(card_name=None, title=None, head=None, body=None):
    if not head: head = ""
    card_title = ""
    if title:
        card_title = f"""
        <div class="row d-flex">
            <div class="col-md-6">
                <h4 class="card-title">{title}</h4>
            </div>
        </div>
            """
    card_body = ""
    if body:
        card_body = f"""
        <div class="card-body">
            {card_body}
        </div>
        """
    if not card_name: card_name = title
    card_header = ""
    if card_title:
        card_header = f"""
            <div class="card-header">
                {card_title}
            </div>
        """

    card_html = f"""
        <div class="col-md-12">
            <div id="{card_name}" class="card">
            {card_header}
            {card_body}
        </div>
        """
    return card_html

def wrap_card_halfwidth(card_name=None, title=None, head=None, body=None):
    if not head: head = ""
    if not title: title = ""
    if not body: body = ""
    if not card_name: card_name = title
    card_html = f"""
            <div class="col-md-6">
                <div id='{card_name}' class="card">
                <div class="card-header">
                    <div class="row d-flex">
                        <div class="col-md-6">
                            <h4 class="card-title">{title}</h4>
                        </div>
                        <div class="col-md-6 text-right">
                            <a href='/'><button id="create_new_product" class="btn btn-primary ml-auto">Go Home</button></a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <h4>An Error has Occurred.</h4>
                    <h5> Please <button id='reload_button' class='btn'>Refresh</button> the page or <a href="/"><button class='btn'>Return Home</button></a></h5>
                    <h5> Alternatively feel free to contact our <button id='fhankyoubtn' class='btn'>Support Team</button></h5>
                    <img id='fhankyou' src="/img/middle.webp" style="display: none"></img>
                </div>
            </div>
        </div>
        """
    return card_html

def wrap_row(html):
    row = f"""
        <div  class="row">
        {html}
        </div>
        """
    return row
