import time
import requests

username = "1"
session = requests.session()

target = "https://gateway.calabashpay.co.za"
#target = "https://qagateway.calabashpay.africa"
sub_target = f"{target}/subcampus"

def get_messages_for_username(username=None, previous_headers=None):
    headers = {}
    if not username: return False
    if not previous_headers: response = session.get(sub_target, params={'id':username})
    else:
        headers['If-Modified-Since'] = previous_headers.get("Last-Modified")
        headers['If-None-Match'] = previous_headers.get("Etag")
        response = session.get(sub_target, params={'id':username}, headers=headers)
        print(response)
    return response

def main():
    previous_headers = None
    while True:
        print('new loop')
        notifications_response = get_messages_for_username(username, previous_headers=previous_headers)
        print(notifications_response)
        if notifications_response: previous_headers = notifications_response.headers
        if notifications_response.status_code == 200:
            #print(notifications_response.json())
            print(notifications_response.text)
        time.sleep(0.5)

if __name__ == '__main__':
    main()
