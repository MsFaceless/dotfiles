#!/bin/python

import hashlib
import os
import requests
import base64

base_url = "http://tripstar.dotxmltech.com"
#base_url = "http://localhost:5000"

curdir = os.path.abspath(os.path.curdir)
datadir = os.path.join(curdir, 'datadir')
if not os.path.exists(datadir): os.mkdir(datadir)

def get_checksum(filecontent=None):
    if not filecontent: return False
    sha256sum = hashlib.sha256()
    sha256sum.update(filecontent)
    return sha256sum.hexdigest()

def test_upload_image():
    headers = {}
    headers['apikey'] = "TotallySecureProductionAPIKEYPHRASE4InfiniteSecurityAndSuchThingsAlso"
    target_url = f"{base_url}/upload_image?"
    target_file = os.path.abspath('/home/camilla/Pictures/heavy3.png')
    with open(target_file, 'rb') as f: contents = f.read()
    checksum = get_checksum(contents)
    package = {}
    file_contents = base64.b64encode(contents)
    package['contents'] = str(file_contents, encoding='utf8')
    package['filename'] = 'heavy3.png'
    package['sha256sum'] = checksum
    package['SOme other stuff to put'] = 'fsdmfdsafsjal'
    package['this will be an mongo key'] = 'this will be a mongo cell'
    r = requests.post(target_url, headers=headers, json=package)
    print(r.text)
    return True

if __name__ == '__main__':
    t = test_upload_image()
